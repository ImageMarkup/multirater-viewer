<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>ISIC V2 MultiRater Viewer</title>
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/openseadragon/built-openseadragon/openseadragon/openseadragon.js"></script>
    <script src="bower_components/svg-overlay/openseadragon-svg-overlay.js"></script>
    <script src="bower_components/webix/codebase/webix.js"></script>
    <link href="bower_components/webix/codebase/webix.css" rel="stylesheet">
    <script src="bower_components/d3/d3.js"></script>
    <!-- Custom JS and CSS here-->
    <!-- <script src="js/isic_multirater.js"></script> -->
    <link href="css/isic_multirater.css" rel="stylesheet">
    <script src="js/isic_multirater_layout.js"></script>

        <script src="multirater.js"></script>
</head>

<body>
    <div id="multirater_layout"></div>
    <div id="osd_viewdiv">
        <h2>OSD Zoomer</h2>
        <div id="openseadragon1" style="width: 100%; height: 800px; border: 1px solid blue" class="openseadragon"></div>
    </div>
    <!-- <div id="isicmrv_header" style="display:none">
  -->
    <!--  <div class="header">
        <div class='content'>
            <a href='http://isic-archive.com' class='top_logo'></a>
            <div class='top_menu'>
                
                <a href="http://webix.com/support/">Support</a>
            </div>
            <span><a href='http://isic-archive.com/' style="color:white">Back to ISIC</a></span>
            <div class="navbar-right ">
                        <span class="navbar-right right-side-button navbar-btn btn-sm">Overlay Opacity: <input id="opacity_slider" data-slider-id='op_slider' type="text" data-slider-min="0" data-slider-max="1" data-slider-step="0.05" data-slider-value="0.5"/></span>
                        <button id="tile_toggle" class="btn btn-default navbar-right navbar-btn btn-sm ">Hide Overlays</button>
                        <button class="btn btn-sm navbar-btn" id="login">Login</button>
                        
                        <li class="active"><a a href="http://isic-archive.com">Home</a></li>
   
        <div class="row inforow">
            <div class="col-md-3 vcenter">
                <p class="text-center">
                    <h3>Data Set<select id="data_source_dd"></select></h3>
                </p>
            </div>
            <div class="col-md-3 vcenter">
                <p class="text-center" style="vertical-align:middle">
                    <b>Image List</b>
                    <select id='image_list_dd' style="width: 50%"></select>
                </p>
            </div>
            <div class="col-md-3 vcenter">
                <p>
                    <span id="feature_info_stats" class=""></span>
                    <span id="tile_info_stats" class=""></span>
                </p>
            </div>
            <div class="col-md-3 vcenter">
                <p class="text-center">
                    <h3>Cur Feature</h3>
                </p>
            </div>
        </div>
   -->
    <!--          <div class="panel panel-default">
                    <div class="panel-heading" align="center">Please select the raters to overlay</div>
                    <div id="rater_info">
                        <div id="tile_opacity"></div>
                        <span id="displayed_data_info" class="h6">
                        <ul id="rater_color_list"></ul>
                        </span>
                    </div>
                </div>
                <div class="panel panel-default"> -->
    <!-- <div class="panel-heading" align="center"><b>Feature Selector</b></div>-->
    <!--<div id="feature_btn_group" class="btn-group btn-group-single featurebtns_wrapper" data-toggle="buttons-radio"></div>-->
    <!--<div id="feature_btn_group" class="featurebtns_wrapper" data-toggle="buttons-radio"></div>-->
    <!--             <div id="feature_accordion"></div>
                </div>
                <div id="curimg_feats"></div>
         -->
    <!-- I am debating creating a second set of buttons listing what's in the current image? -->
    <!--     </div>
           <div class="col-xs-8"> -->
    <!-- <div id="filter_dialog" style="display:none" title="Apply Filters">
        Filter set will appear here
    </div> -->
    <script>
    
    var superpixel_markup_info = [];
    var imageInfoList = {}; //This contains a list for all loaded images...

    sampleDZI = 'http://node15.cci.emory.edu/cgi-bin/iipsrv.fcgi?DeepZoom=/PYRAMIDS/PYRAMIDS/CDSA/GBM_Frozen/intgen.org_GBM.tissue_images.3.0.0/TCGA-06-0137-01A-01-BS1.svs.dzi.tif.dzi'


    baseURL = "http://dermannotator.org:8000/v2"

    imageSetName = 'ISIC_UDA-2_1'
    imageName = 'ISIC_0001111'
    spxSuffix = '_superpixels_v3.0.png.svg.json'
    imgSuffix = '.jpg'

    imgURL = baseURL + '/' + imageSetName + '/' + imageName + '/' + imageName + imgSuffix;
    imgSVGuRL = baseURL + '/' + imageSetName + '/' + imageName + '/' + imageName + spxSuffix;
    current_feature = "blob";



 // console.log('need to load svg data for' + imageName);
 //    SVG_file = image_info_list[imageName].superpixel_svg;
 //    img_height = image_info_list[imageName].img_height;
 //    img_width = image_info_list[imageName].img_width;

    imageInfoList[imageName] = { 
                    'superpixel_svg': imgSVGuRL,
                    'img_height': 2848,
                    'img_width': 4288
                    }


     $.getJSON(imgSVGuRL, function(data) {
        superpixel_markup_info = data;
        //I am going to disable buttons on the feature list if that feature isn't present in the currnet image...
        // hide_unannotated_features(superpixel_markup_info);
        

        loadSVGTileData(imageName)
        // show_all_tiles();
        // new_mark_superpixels();
    })


    webSelectedImageTileSource = {
        'type': 'legacy-image-pyramid',
        levels: [{
            'url': imgURL,
            'height':  2848,
            'width': 4288
        }]

    }


    var dg_viewer = OpenSeadragon({
        id: "openseadragon1",
        prefixUrl: "bower_components/openseadragon/built-openseadragon/openseadragon/images/",
        showNavigator: true,
        tileSources: webSelectedImageTileSource,
        maxZoomLevel: 10
    });

    svg_layer = dg_viewer.svgOverlay(); //need to move to onload handler


    </script>
</body>
